# C++ - 스마트 포인터

온라인 서브시스템에 대해서 공부하던 중 공유 포인터에 개념에 대해서 알아보게 됐다.<br>
그래서 그 기본 개념인 스마트 포인터와 그 종류들인 유니크 포인터와 공유 포인터에 대해서 공부하게 됐다.

## Stack vs Heap

스택과 힙은 C++에서 메모리를 관리하는 방식들이다.

스택은 정적 메모리 관리, 힙은 동적 메모리 할당을 뜻한다.

포인터는 스택 영역에서 생성되어 힙에 원하는 메모리를 가리키는 방식으로 동작되며 힙에서 동적으로 메모리가 할당되기에 생성과 소멸 시기가 불분명하여 해당 메모리를 가리키는 포인터를 통한 메모리 관리가 중요하다. 스택 영역에 포인터가 소멸될 때 포인터가 가리키는 힙 영역에 메모리의 소멸까지 책임지지 않으면 해당 메모리에 공간을 차지하기에 메모리 누수로 이어지게 된다.

이러한 문제를 해결하기 위해서 도입된 개념이 스마트 포인터이다.

## 스마트 포인터

기존 포인터는 포인터를 삭제하더라도 원래 데이터는 삭제 되지 않기에 메모리 관리 측면에서 비효율적인 부분을 보이는데 새로운 개념인 스마트 포인터는 이 부분을 보완해서 스마트 포인터를 해제하는 상황이 되면 그 가리키는 메모리도 같이 소멸해서 메모리 관리 측면에서 유용하게 관리되는 기능을 뜻한다.

이 중 유니크 포인터는 가장 엄격한 스마트 포인터로 오직 하나의 포인터로만 메모리를 관리하며 복제, 공유 등이 불가하다. 이동을 통해서만 다른 포인터로 원시 데이터를 이동하는 것이 가능하다.

이 부분에서 불편함이 있기에 나온 것이 공유 포인터이다. 공유 포인터는 참조 카운팅 방식을 사용해서 메모리를 관리하기에 유니크 포인터에서는 불가했던 메모리 공유, 복제 등의 기능이 가능해진다.<br>
공유 포인터는 기존 메모리에서 참조 카운트를 관리해서 스마트 포인터가 특정 메모리를 가리키면 그 때 그 메모리에서 참조 카운트를 올리고 해제하면 줄이는 방식으로 참조 카운트를 통해서 현재 메모리를 가리키는 포인터들의 개수를 관리하고 이것이 0이 되면 그 때 메모리가 소멸되는 방식을 취하게 된다. <br>
언리얼에서는 이를 보다 효율적으로 관리하기 위해 바로 소멸하는 것이 아니라 가비지 컬렉션을 사용해서 해당 컬렉션에 등록 후 가능해질 때 해당 메모리를 소멸하는 작업을 진행한다. 이를 통해서 언리얼에서 보다 렉이 덜한 방식으로 메모리 소멸이 가능해진다.<br>
이를 통해서 공유 포인터의 방식으로도 스마트 포인터의 목표인 효율적인 메모리 관리가 가능해진다.

단, 주의해야할 점으로는 순환 참조 즉, 포인터로 가리키는 객체가 서로를 가리켜서 참조 카운트가 0이 되는 경우가 불가하게 되는 경우가 발생되지 않도록 이 부분에서는 주의해야한다.
