# SimpleShooter (2)

## 애니메이션 블루프린트

애니메이션의 로직 구현은 유니티와 마찬가지로 이 곳에서도 C++로 하기에 적합하지 않다. 그래서 언리얼에서도 결과를 보면서 작업하기 유용한 애니메이션 블루프린트를 생성하여 애니메이션의 로직을 구성하게 된다.

처음 애니메이션 블루프린트를 만들면 볼 수 있는 그래프인데 저 출력 포즈칸에 최종적인 로직의 결과물을 넣게 됨으로써 애니메이션의 종합적인 구조를 출력하게 되는 방식이다.
![3](/Assets/Images/Unreal/실습/SimpleShooter/3.png)

### 보행 이동 애니메이션 - 블렌드 스페이스

이동에 관한 애니메이션은 360도 방위와 속도에 따른 애니메이션 블렌딩을 해야하기에 기존에 방식들로는 원활한 블렌딩의 어려움을 겪을 수 있다. 이럴 때 사용하면 좋은 언리얼의 기능으로 블렌드 스페이스가 있다.

블렌드 스페이스는 2차원 구조에서 변수에 따라서 애니메이션을 블렌드해주는 기능을 가지고 있는데 보행 이동의 구현에서는 예를 들면 Angle과 Speed 변수를 만들고 해당 각도와 스피드에 따른 애니메이션들을 넣으면 된다. <br>
예를 들어 스피드 50의 앵글이 90도면 오른쪽으로 걷는 애니메이션을 넣어주고 스피드 0 앵글 0 이면 가만히 서있는 동작을 넣어준다.<br>
이렇게 보행 이동 애니메이션같이 여러 애니메이션이 수치에 따라 섞일 때는 블렌드 스페이스 기능이 유용하다.

아래 사진은 실제 Angle과 Speed를 각 축으로 하여 애니메이션을 블렌드 스페이스에 배치한 모습이다.
![4](/Assets/Images/Unreal/실습/SimpleShooter/4.png)

### 이동 애니메이션 블루프린트

아래는 애니메이션 블루프린트에서 이동에 대한 애니메이션 로직이다.
![5](/Assets/Images/Unreal/실습/SimpleShooter/5.png)

여기서 우리가 설정할 값은 Speed와 Angle인데 이 값은 애니메이션을 취할 Pawn에게서 얻게 된다.

Speed: 스피드는 Pawn의 Velocity(속도)의 값을 얻어와서 세팅해준다.

Angle: 현재 플레이어의 회전 각도는 플레이어 기준에서의 로컬 좌표에서 어떻게 회전하고 있는지를 얻어와야한다.<br>
이 때 벡터의 역방향 트랜스폼을 구해야 하는데 그 이유는 Pawn에게서 Velocity를 얻을 때 이 값은 월드 좌표계를 기준으로 하고 있다.<br>
하지만 우리는 로컬 좌표에서 회전을 얼마나 하고 있는지 알고 싶은 것이므로 이 Velocity를 현재 Pawn 기준으로 역방향 트랜스폼을 하여 값을 얻어낼 필요가 있다.<br>
그래서 위처럼 Inverse Transform을 하여 Velocity를 로컬 좌표로 변경하여 Yaw 회전값을 얻어내야 올바르게 캐릭터의 이동을 처리할 수 있다.

### 애니메이션 속도와 일치시키기

이동에 관한 속도에 따른 애니메이션 속도를 처리하기 위해서 각 애니메이션에 들어가서 한 동작당 이동하는 속도를 알아낸 뒤 이를 이동 블렌드 스페이스의 속도 값과 일치시켜 주었다.

최종적으로 미끄러지는 동작이 아닌 자연스럽게 이동하는 모습을 구현해낼 수 있었다.
![6](/Assets/Images/Unreal/실습/SimpleShooter/6.png)
